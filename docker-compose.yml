# blog-project/docker-compose.yml
version: '3.8'

services:
  backend:
    build: ./backend # 使用 backend 目录下的 Dockerfile 构建
    container_name: blog_backend
    restart: always # 容器异常退出时自动重启
    environment:
      # 生产环境需要设置一个更复杂的 SECRET_KEY
      SECRET_KEY: "your_super_secret_key_for_production"
      # 数据库路径：映射到宿主机，确保数据持久化
      DATABASE_URL: "sqlite:////app/instance/app.db"
    volumes:
      # 映射本地路径到容器内部，数据库文件会存在你的服务器本地
      - ./backend/instance:/app/instance
    # 端口映射只在调试时需要，Nginx 会代理，所以生产环境可以注释掉
    ports:
     - "5001:5000"

  frontend:
    build: ./frontend # 使用 frontend 目录下的 Dockerfile 构建
    container_name: blog_frontend
    restart: always
    ports:
      - "8080:80" # 将宿主机的 80 端口映射到容器的 80 端口 (Nginx)
    depends_on:
      - backend # 确保后端先启动 (非强制依赖，但通常需要)